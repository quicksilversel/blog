---
title: 'Setting Up Dark Theme with Emotion & Next.js'
description: 'Set up a dark/light theme toggle in a NextJS app with Emotion that respects user preferences'
topics: ['css in js']
published: true
date: '2024-07-21'
---

## Define Theme Colors

Setting up light and dark theme palettes upfront makes it easier to manage and switch between them later. I usually keep a `themes.ts` file to centralize color definitions.

```ts
const commonTheme = {
  primary: 'hsl(245deg, 100%, 60%)',
}

export const darkTheme = {
  ...commonTheme,
  background: 'hsl(210deg, 30%, 8%)',
  text: 'hsl(0deg, 0%, 100%)',
}

export const lightTheme = {
  ...commonTheme,
  background: 'hsl(0deg, 0%, 100%)',
  text: 'hsl(222deg, 22%, 5%)',
}
```

I‚Äôve come to realize that using HSL values instead of hex makes tweaking themes much more intuitive ‚Äî especially when adjusting lightness for dark mode.

More on that [here](https://www.joshwcomeau.com/css/color-formats/).

## Define the Theme Type

To get proper type safety with Emotion in a TypeScript setup, I extend the default theme declaration like this:

```ts
import '@emotion/react'

declare module '@emotion/react' {
  export interface Theme {
    background: string
    text: string
    primary: string
  }
}
```

## Detect User Preference

Respecting user preferences is key for a good UX. I want the theme to default to light mode if the user prefers it, but also allow them to switch manually.
I use `localStorage` to save their choice, so it persists across sessions. If they haven‚Äôt chosen yet, I check their system preference using `window.matchMedia`.

```ts
useEffect(() => {
  const savedTheme = localStorage.getItem('theme')
  const prefersLight =
    window.matchMedia &&
    window.matchMedia('(prefers-color-scheme: light)').matches

  if (savedTheme) {
    setTheme(savedTheme === 'dark' ? 'dark' : 'light')
  } else if (prefersLight) {
    setTheme('light')
  }
}, [])
```

## Add ThemeProvider to \_app.tsx

Here‚Äôs the core of the setup. The theme logic wraps the app with both `CacheProvider` and `ThemeProvider`, which makes it available everywhere!

```tsx
import { useState, useEffect } from 'react'
import { ThemeProvider, CacheProvider } from '@emotion/react'
import { cache } from '@emotion/css'
import type { AppProps } from 'next/app'
import { lightTheme, darkTheme } from '@/components/Styles/themes'

export type ThemeContext = {
  theme: 'light' | 'dark'
  setTheme: (theme: 'light' | 'dark') => void
}

function MyApp({ Component, pageProps }: AppProps) {
  const [theme, setTheme] = useState<ThemeContext['theme']>('dark')

  useEffect(() => {
    const savedTheme = localStorage.getItem('theme')
    const prefersLight =
      window.matchMedia &&
      window.matchMedia('(prefers-color-scheme: light)').matches

    if (savedTheme) {
      setTheme(savedTheme === 'dark' ? 'dark' : 'light')
    } else if (prefersLight) {
      setTheme('light')
    }
  }, [])

  return (
    <CacheProvider value={cache}>
      <ThemeProvider theme={theme === 'dark' ? darkTheme : lightTheme}>
        <Component {...pageProps} />
        <ThemeToggler theme={theme} setTheme={setTheme} />
      </ThemeProvider>
    </CacheProvider>
  )
}

export default MyApp
```

## Use the Theme in Components

Styled components pick up the theme automatically, which is why defining keys like `text` and `background` helps make things more reusable.

```tsx
import styled from '@emotion/styled'

const Text = styled.span`
  color: ${({ theme }) => theme.text};
`

export const MyComponent = () => {
  return <Text>Hello, theme world!</Text>
}
```

## Theme Toggle Button

This little button toggles the theme and saves the choice to `localStorage`, so it persists across page reloads.

```tsx
import type { ThemeContext } from '@/pages/_app'

export const ThemeToggler = ({ theme, setTheme }: ThemeContext) => {
  const toggleTheme = () => {
    const newTheme = theme === 'light' ? 'dark' : 'light'
    setTheme(newTheme)
    localStorage.setItem('theme', newTheme)
  }

  return <button onClick={toggleTheme}>{theme === 'dark' ? 'üåô' : '‚òÄÔ∏è'}</button>
}
```

I usually place it inside `_app.tsx` or in the header layout so users can switch anytime.

## Done!

With this setup, the theme switches instantly and respects both system and user preferences. Everything stays clean and predictable ‚Äî plus it opens the door for adding smooth transitions or dark-mode-specific UI tweaks later.
